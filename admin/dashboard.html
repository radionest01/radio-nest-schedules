<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Nest Dashboard</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: #0f0f0f;
            color: white;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .sidebar h2 {
            font-size: 22px;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .sidebar button {
            background: none;
            border: none;
            color: white;
            padding: 12px 0;
            text-align: left;
            font-size: 16px;
            cursor: pointer;
            opacity: 0.8;
            transition: 0.2s;
        }

        .sidebar button:hover {
            opacity: 1;
        }

        /* Main Content */
        .main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            font-size: 26px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* Schedule Grid */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
        }

        .day-column {
            background: rgba(255, 255, 255, 0.04);
            padding: 15px;
            border-radius: 10px;
            min-height: 200px;
        }

        .day-column h3 {
            margin-top: 0;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .show-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: 0.2s;
        }

        .show-card:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        /* Add Show Button */
        .add-show-btn {
            margin-top: 20px;
            padding: 12px 18px;
            background: #ff7b00;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            color: white;
            font-weight: 600;
            transition: 0.2s;
        }

        .add-show-btn:hover {
            background: #ff8f26;
        }

        /* Modal */
        .modal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 12px;
            width: 420px;
        }

        .modal h2 {
            margin-top: 0;
            font-size: 22px;
        }

        .modal input, .modal select, .modal textarea {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: none;
            background: rgba(255,255,255,0.08);
            color: white;
        }

        .modal button {
            width: 100%;
            padding: 12px;
            background: #ff7b00;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            color: white;
            font-weight: 600;
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>Radio Nest</h2>
        <button>Dashboard</button>
        <button>Hosts</button>
        <button>Branding</button>
        <button>Embed</button>
        <button>Account</button>
    </div>

    <!-- Main -->
    <div class="main">
        <div class="header">Schedule</div>

        <button class="add-show-btn" onclick="openModal()">Add Show</button>

        <div class="schedule-grid" id="scheduleGrid"></div>
    </div>

    <!-- Modal -->
    <div class="modal-bg" id="modalBg">
        <div class="modal">
            <h2>Add Show</h2>

            <input id="showTitle" placeholder="Show Title">

            <select id="showDay">
                <option value="0">Monday</option>
                <option value="1">Tuesday</option>
                <option value="2">Wednesday</option>
                <option value="3">Thursday</option>
                <option value="4">Friday</option>
                <option value="5">Saturday</option>
                <option value="6">Sunday</option>
            </select>

            <input id="showStart" type="time">
            <input id="showEnd" type="time">

            <select id="hostSelect"></select>

            <textarea id="showDescription" placeholder="Description"></textarea>

            <button onclick="saveShow()">Save Show</button>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_BUCKET",
            messagingSenderId: "YOUR_SENDER",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();

        let stationID = null;
        let uid = null;

        onAuthStateChanged(auth, async (user) => {
            if (!user) return;

            uid = user.uid;

            const userRef = doc(db, "users", uid);
            const userSnap = await getDoc(userRef);

            stationID = userSnap.data().stationID;

            loadHosts();
            loadShows();
        });

        async function loadHosts() {
            const hostSelect = document.getElementById("hostSelect");
            hostSelect.innerHTML = "";

            const hostsRef = collection(db, "users", uid, "stations", stationID, "hosts");
            const hostsSnap = await getDocs(hostsRef);

            hostsSnap.forEach(doc => {
                const h = doc.data();
                const opt = document.createElement("option");
                opt.value = doc.id;
                opt.textContent = h.name;
                opt.dataset.image = h.imageUrl;
                hostSelect.appendChild(opt);
            });
        }

        async function loadShows() {
            const grid = document.getElementById("scheduleGrid");
            grid.innerHTML = "";

            const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

            for (let i = 0; i < 7; i++) {
                const col = document.createElement("div");
                col.className = "day-column";
                col.innerHTML = `<h3>${days[i]}</h3>`;
                grid.appendChild(col);
            }

            const showsRef = collection(db, "users", uid, "stations", stationID, "shows");
            const showsSnap = await getDocs(showsRef);

            showsSnap.forEach(docSnap => {
                const show = docSnap.data();
                const card = document.createElement("div");
                card.className = "show-card";
                card.innerHTML = `
                    <strong>${show.title}</strong><br>
                    ${show.start} - ${show.end}<br>
                    ${show.hostName}
                `;
                grid.children[show.day].appendChild(card);
            });
        }

        function openModal() {
            document.getElementById("modalBg").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("modalBg").style.display = "none";
        }

        async function saveShow() {
            const title = document.getElementById("showTitle").value;
            const day = parseInt(document.getElementById("showDay").value);
            const start = document.getElementById("showStart").value;
            const end = document.getElementById("showEnd").value;
            const desc = document.getElementById("showDescription").value;

            const hostSelect = document.getElementById("hostSelect");
            const hostId = hostSelect.value;
            const hostName = hostSelect.options[hostSelect.selectedIndex].textContent;
            const hostImageUrl = hostSelect.options[hostSelect.selectedIndex].dataset.image;

            await addDoc(collection(db, "users", uid, "stations", stationID, "shows"), {
                title,
                day,
                start,
                end,
                description: desc,
                hostId,
                hostName,
                hostImageUrl
            });

            closeModal();
            loadShows();
        }
    </script>

</body>
</html>
