<!DOCTYPE html>
<html>
<head>
  <title>Radio Nest Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="navbar">
  <h2>Radio Nest</h2>
  <button onclick="logout()">Logout</button>
</div>

<div id="tabs">
  <button class="tab" onclick="showTab('schedule')">Schedule</button>
  <button class="tab" onclick="showTab('hosts')">Hosts</button>
  <button class="tab" onclick="showTab('branding')">Branding</button>
  <button class="tab" onclick="showTab('embed')">Embed Code</button>
  <button class="tab" onclick="showTab('account')">Account</button>
</div>

<!-- CONTENT HIDDEN UNTIL USER IS VERIFIED -->
<div id="content" style="display:none;">

  <div id="schedule" class="tabContent">
    <h3>Schedule</h3>
    <p>Schedule editor will go here.</p>
  </div>

  <div id="hosts" class="tabContent" style="display:none;">
    <h3>Hosts</h3>
    <p>Host management will go here.</p>
  </div>

  <div id="branding" class="tabContent" style="display:none;">
    <h3>Branding</h3>
    <p>Branding settings will go here.</p>
  </div>

  <div id="embed" class="tabContent" style="display:none;">
    <h3>Embed Code</h3>
    <p>Embed generator will go here.</p>
  </div>

  <div id="account" class="tabContent" style="display:none;">
    <h3>Account</h3>
    <p>Account details will go here.</p>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script src="firebase.js"></script>
<script src="auth.js"></script>

<script>
// Tab switching
function showTab(tabName) {
  document.querySelectorAll('.tabContent').forEach(div => div.style.display = 'none');
  document.getElementById(tabName).style.display = 'block';
}

// PROTECT DASHBOARD (FIXED)
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  // Wait for Firestore to load the user document
  db.collection("users").doc(user.uid).onSnapshot(doc => {
    if (!doc.exists) {
      window.location.href = "licence.html";
      return;
    }

    const data = doc.data();
    if (!data) return; // prevents early redirect

    if (!data.firstLoginComplete) {
      window.location.href = "licence.html";
      return;
    }

    // User is activated â€” show dashboard
    document.getElementById("content").style.display = "block";
  });
});
</script>

</body>
</html>
